from telegram import Update
from telegram.ext import ContextTypes, CommandHandler
from util import load_users, save_users

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Handle /start command and store user ID"""
    user = update.effective_user
    
    # Load existing users
    users = load_users()
    
    # Add new user if not already present
    if str(user.id) not in users:
        users.append(str(user.id))
        save_users(users)
        message = (
            "âœ¦ ğ—›ğ—²ğ˜† ğ˜ğ—µğ—²ğ—¿ğ—²! âœ¦\n\n"
            "I ğ—®ğ—º ğ˜ğ—µğ—² ğ—½ğ—¿ğ—¼ğ˜‚ğ—± ğ—¯ğ—¼ğ˜ ğ—¼ğ—³ ğ˜ğ—µğ—² ğ—”ğ—»ğ—¶ğ—ºğ—² ğ—¢ğ—°ğ—²ğ—®ğ—» ğ—°ğ—¼ğ—ºğ—ºğ˜‚ğ—»ğ—¶ğ˜ğ˜†.\n"
            "ğ— ğ˜† ğ—ºğ—®ğ—¶ğ—» ğ—±ğ˜‚ğ˜ğ˜† ğ—¶ğ˜€ ğ˜ğ—¼ ğ—¸ğ—²ğ—²ğ—½ ğ˜ğ—µğ—² ğ—°ğ—µğ—®ğ—»ğ—»ğ—²ğ—¹ âŸª @Animes_News_Ocean âŸ« ğ—³ğ—¶ğ—¹ğ—¹ğ—²ğ—± ğ˜„ğ—¶ğ˜ğ—µ ğ—³ğ—¿ğ—²ğ˜€ğ—µ ğ—®ğ—»ğ—¶ğ—ºğ—² ğ—»ğ—²ğ˜„ğ˜€!\n\n"
            "â‹† ğ—¥ğ—¶ğ—´ğ—µğ˜ ğ—»ğ—¼ğ˜„, ğ—œ ğ—³ğ—¼ğ—¿ğ˜„ğ—®ğ—¿ğ—± ğ—®ğ—¹ğ—¹ ğ˜ğ—µğ—² ğ—¹ğ—®ğ˜ğ—²ğ˜€ğ˜ ğ˜‚ğ—½ğ—±ğ—®ğ˜ğ—²ğ˜€ ğ˜€ğ˜ğ—¿ğ—®ğ—¶ğ—´ğ—µğ˜ ğ˜ğ—µğ—²ğ—¿ğ—².\n"
            "ğ—•ğ˜‚ğ˜ ğ˜ğ—¼ ğ—³ğ˜‚ğ—¿ğ˜ğ—µğ—²ğ—¿ ğ—²ğ—»ğ—¿ğ—¶ğ—°ğ—µ ğ—¼ğ˜‚ğ—¿ ğ—°ğ—¼ğ—ºğ—ºğ˜‚ğ—»ğ—¶ğ˜ğ˜†, ğ˜„ğ—² ğ—®ğ—¿ğ—² ğ—½ğ—¹ğ—®ğ—»ğ—»ğ—¶ğ—»ğ—´ ğ—® ğ—ºğ—®ğ—·ğ—¼ğ—¿ ğ˜‚ğ—½ğ—´ğ—¿ğ—®ğ—±ğ—².\n"
            "ğ—¦ğ—¼ğ—¼ğ—», ğ˜„ğ—¶ğ˜ğ—µ ğ˜ğ—µğ—² ğ—»ğ—²ğ˜„ ğ˜‚ğ—½ğ—±ğ—®ğ˜ğ—², ğ—œâ€™ğ—¹ğ—¹ ğ—¯ğ—² ğ—®ğ—¯ğ—¹ğ—² ğ˜ğ—¼ ğ—³ğ—¼ğ—¿ğ˜„ğ—®ğ—¿ğ—± ğ—»ğ—²ğ˜„ğ˜€ ğ—±ğ—¶ğ—¿ğ—²ğ—°ğ˜ğ—¹ğ˜† ğ—¶ğ—»ğ˜ğ—¼ ğ˜†ğ—¼ğ˜‚ğ—¿ ğ—´ğ—¿ğ—¼ğ˜‚ğ—½ğ˜€ ğ˜ğ—¼ğ—¼.\n\n"
            "â¤ ğ——ğ—¼ğ—»â€™ğ˜ ğ˜„ğ—¼ğ—¿ğ—¿ğ˜†, ğ—œ ğ˜„ğ—¶ğ—¹ğ—¹ ğ—¶ğ—»ğ—³ğ—¼ğ—¿ğ—º ğ˜†ğ—¼ğ˜‚ ğ˜„ğ—µğ—²ğ—» ğ˜ğ—µğ—² ğ—»ğ—²ğ˜„ ğ˜ƒğ—²ğ—¿ğ˜€ğ—¶ğ—¼ğ—» ğ—¿ğ—²ğ—¹ğ—²ğ—®ğ˜€ğ—²ğ˜€.\n\n"
            "â˜† ğ—§ğ—µğ—®ğ—»ğ—¸ğ˜€ ğ—³ğ—¼ğ—¿ ğ—¯ğ—²ğ—¶ğ—»ğ—´ ğ—µğ—²ğ—¿ğ—². ğ—¦ğ˜ğ—®ğ˜† ğ˜ğ˜‚ğ—»ğ—²ğ—±, ğ—²ğ˜…ğ—°ğ—¶ğ˜ğ—¶ğ—»ğ—´ ğ˜ğ—¶ğ—ºğ—²ğ˜€ ğ—®ğ—µğ—²ğ—®ğ—±!\n\n"
            "ğ—¡ğ—²ğ—²ğ—± ğ˜€ğ˜‚ğ—½ğ—½ğ—¼ğ—¿ğ˜? ğ—–ğ—¼ğ—»ğ˜ğ—®ğ—°ğ˜: @suu_111"
        )


    else:
        message = f"ğŸ‘‹ Welcome back {user.first_name}!"
    
    await update.message.reply_text(message)

def get_start_handler():
    return CommandHandler("start", start_command)